@using MudBlazor
@using PortfolioWebsite.Models
@using PortfolioWebsite.Services
@using Microsoft.AspNetCore.Components
@inherits LayoutComponentBase

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme" />
<MudDialogProvider />
<MudSnackbarProvider />

<!-- Animated Background -->
<AnimatedBackground @ref="AnimatedBackgroundRef" DarkMode="@_isDarkMode" />

<!-- Main Content Area -->
<main class="main-content">
    @Body
</main>

@code {
    private bool _isDarkMode;
    private MudTheme _theme = new();
    private PortfolioData _portfolioData = new();
    private AnimatedBackground AnimatedBackgroundRef;

    [Inject] private PortfolioDataService PortfolioDataService { get; set; } = default!;
    [Inject] private ThemeService ThemeService { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    protected override void OnInitialized()
    {
        _isDarkMode = ThemeService.IsDarkMode;
        _portfolioData = PortfolioDataService.GetPortfolioData();
        _theme = ThemeService.GetCurrentTheme();
        ThemeService.OnThemeChanged += OnThemeChanged;
    }

    private void OnThemeChanged()
    {
        _isDarkMode = ThemeService.IsDarkMode;
        _theme = ThemeService.GetCurrentTheme();
        StateHasChanged();
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= OnThemeChanged;
    }
}
