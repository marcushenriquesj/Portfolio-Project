@using MudBlazor
@using PortfolioWebsite.Models
@using PortfolioWebsite.Services
@using Microsoft.AspNetCore.Components
@inherits LayoutComponentBase

<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" Theme="_theme" />
<MudDialogProvider />
<MudSnackbarProvider />

<!-- Animated Background -->
<AnimatedBackground @ref="AnimatedBackgroundRef" DarkMode="@_isDarkMode" />

<!-- Global Navigation Header -->
<div class="nav-header">
    <div class="nav-background">
        <div class="glow-circle glow-circle-1"></div>
        <div class="glow-circle glow-circle-2"></div>
    </div>
    <div class="nav-container">
        <div class="nav-brand">
            <a href="">
                <span class="nav-name">@_portfolioData.Name</span>
                <span class="nav-separator">/</span>
                <span class="nav-portfolio">PORTFOLIO</span>
            </a>
        </div>
        <div class="nav-links">
            <a href="about" class="nav-link-text">ABOUT</a>
            <a href="experience" class="nav-link-text">EXPERIENCE</a>
            <a href="projects" class="nav-link-text">PROJECTS</a>
            <a href="contact" class="nav-link-text">CONTACT</a>
        </div>
        
    </div>
</div>


<!-- Main Content Area -->
<main class="main-content">
    @Body
</main>

@code {
    private bool _isDarkMode;
    private MudTheme _theme = new();
    private PortfolioData _portfolioData = new();
    private AnimatedBackground AnimatedBackgroundRef;

    [Inject] private PortfolioDataService PortfolioDataService { get; set; } = default!;
    [Inject] private ThemeService ThemeService { get; set; } = default!;
    [Inject] private NavigationManager Navigation { get; set; } = default!;

    protected override void OnInitialized()
    {
        _isDarkMode = ThemeService.IsDarkMode;
        _portfolioData = PortfolioDataService.GetPortfolioData();
        _theme = ThemeService.GetCurrentTheme();
        ThemeService.OnThemeChanged += OnThemeChanged;
    }

    private void OnThemeChanged()
    {
        _isDarkMode = ThemeService.IsDarkMode;
        _theme = ThemeService.GetCurrentTheme();
        StateHasChanged();
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= OnThemeChanged;
    }
}
